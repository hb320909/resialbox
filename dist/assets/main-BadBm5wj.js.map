{"version":3,"file":"main-BadBm5wj.js","sources":["../../app.js"],"sourcesContent":["// --- Supabase setup ---\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = 'https://upznvkoiiiazvnuowhdr.supabase.co'\nconst supabaseKey = 'sb_publishable_TaFJ0GGjMhmCGnGi4N4dyA_auGwFljE'\nconst supabase = createClient(supabaseUrl, supabaseKey)\n\n// Helper function to ensure DOM is ready\nfunction onDOMReady(callback) {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', callback);\n    } else {\n        callback();\n    }\n}\n\n// Data storage\nlet students = [];\nlet absences = [];\nlet reports = [];\nlet homeworks = {};\nlet currentUser = '';\nlet currentSection = 'dashboard';\n\n// User credentials\nconst users = {\n    'Kati': 'sun12',\n    'Alvaro': 'rock34',\n    'Juan Ignacio': 'wiz56',\n    'Maria Jose': 'moon78',\n    'Jose Antonio': 'thun90',\n    'Lourdes': 'rain21',\n    'Ruben': 'comet43',\n    'Belen': 'star65',\n    'Adolfo': 'king999'\n};\n\n// Initialize rooms\nfunction initializeRooms() {\n    // Estructura de habitaciones:\n    // Planta 1: Hombres 101-104 (izq), Mujeres 201-202 (der)\n    // Planta 2: Hombres 201-204 (izq), Mujeres 301-304 (der)\n    // Cada habitaciÃ³n tiene 6 camas: A, B, C, D, E, F\n    rooms = [];\n    \n    const bedLetters = ['A', 'B', 'C', 'D', 'E', 'F'];\n    \n    const createRooms = (startNum, endNum, gender, floor, side) => {\n        for (let i = startNum; i <= endNum; i++) {\n            const number = `${i}`;\n            const beds = {};\n            bedLetters.forEach(letter => {\n                beds[letter] = null; // null significa cama vacÃ­a\n            });\n            \n            rooms.push({ \n                number, \n                capacity: 6, \n                occupied: 0, \n                beds: beds, // estructura: { A: studentId/null, B: studentId/null, ... }\n                type: 'para 6', \n                gender: gender, \n                floor: floor,\n                side: side\n            });\n        }\n    };\n    \n    // Planta 1 - Hombres (101-104)\n    createRooms(101, 104, 'hombre', 1, 'izquierda');\n    \n    // Planta 1 - Mujeres (201-202)\n    createRooms(201, 202, 'mujer', 1, 'derecha');\n    \n    // Planta 2 - Hombres (211-214)\n    createRooms(211, 214, 'hombre', 2, 'izquierda');\n    \n    // Planta 2 - Mujeres (301-304)\n    createRooms(301, 304, 'mujer', 2, 'derecha');\n}\n\n// Utility: calculate age in years from a YYYY-MM-DD date string\nfunction calculateAge(dateString) {\n    if (!dateString) return null;\n    const today = new Date();\n    const birth = new Date(dateString);\n    if (isNaN(birth)) return null;\n    let age = today.getFullYear() - birth.getFullYear();\n    const m = today.getMonth() - birth.getMonth();\n    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {\n        age--;\n    }\n    return age;\n}\n\n// Check for birthdays today\nfunction checkBirthdays() {\n    const today = new Date();\n    const currentMonth = today.getMonth() + 1; // 1-12\n    const currentDay = today.getDate();\n    \n    const birthdayStudents = students.filter(student => {\n        if (!student.fechaNacimiento) return false;\n        const birthDate = new Date(student.fechaNacimiento + 'T00:00:00');\n        if (isNaN(birthDate)) return false;\n        \n        const birthMonth = birthDate.getMonth() + 1;\n        const birthDay = birthDate.getDate();\n        \n        return birthMonth === currentMonth && birthDay === currentDay;\n    });\n    \n    if (birthdayStudents.length > 0) {\n        showBirthdayModal(birthdayStudents);\n    }\n}\n\nfunction showBirthdayModal(students) {\n    const modal = document.getElementById('birthdayModal');\n    const message = document.getElementById('birthdayMessage');\n    \n    if (students.length === 1) {\n        message.textContent = `Hoy es el cumpleaÃ±os de ${students[0].nombre}`;\n    } else {\n        const names = students.map(s => s.nombre).join(', ');\n        message.textContent = `Â¡Hoy es el cumpleaÃ±os de ${names}!`;\n    }\n    \n    modal.classList.remove('hidden');\n    \n    // Create confetti animation\n    createConfetti();\n    \n    // Auto-close after 6 seconds\n    setTimeout(() => {\n        closeBirthdayModal();\n    }, 6000);\n}\n\nfunction closeBirthdayModal() {\n    const modal = document.getElementById('birthdayModal');\n    modal.classList.add('hidden');\n}\n\nfunction createConfetti() {\n    const container = document.getElementById('confettiContainer');\n    if (!container) return;\n    \n    // Clear previous confetti\n    container.innerHTML = '';\n    \n    const confettiPieces = 50;\n    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];\n    \n    for (let i = 0; i < confettiPieces; i++) {\n        const piece = document.createElement('div');\n        piece.className = 'confetti-piece absolute w-2 h-2 rounded-full';\n        piece.style.left = Math.random() * 100 + '%';\n        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];\n        piece.style.animationDelay = (Math.random() * 0.5) + 's';\n        piece.style.opacity = '0.8';\n        container.appendChild(piece);\n    }\n}\n\n/// --- Global variables ---\n// Note: students, absences, reports, homeworks are already declared at the top of the file\n\n// --- Load data from Supabase ---\nasync function loadData() {\n    // Fetch students\n    const { data: studentsData, error: studentsError } = await supabase\n        .from('students')\n        .select('*');\n\n    students = studentsError ? [] : studentsData;\n    if (studentsError) console.error('Error loading students:', studentsError);\n\n    // Fetch absences\n    const { data: absencesData, error: absencesError } = await supabase\n        .from('absences')\n        .select('*');\n\n    absences = absencesError ? [] : absencesData;\n    if (absencesError) console.error('Error loading absences:', absencesError);\n\n    // Fetch reports\n    const { data: reportsData, error: reportsError } = await supabase\n        .from('reports')\n        .select('*');\n\n    reports = reportsError ? [] : reportsData;\n    if (reportsError) console.error('Error loading reports:', reportsError);\n\n    // Initialize UI\n    initializeRooms();\n    updateDashboard();\n    updateStudentsTable();\n    updateRoomsGrid();\n    updateAbsencesTable();\n    updateReportsTable();\n    populateDropdowns();\n    loadHomeworks(); // optional\n    renderAgenda();\n    checkBirthdays();\n\n    // Optional: save fetched data to localStorage\n    localStorage.setItem('students', JSON.stringify(students));\n    localStorage.setItem('absences', JSON.stringify(absences));\n    localStorage.setItem('reports', JSON.stringify(reports));\n}\n\n// --- Save functions ---\nasync function saveStudent(student) {\n    const { error } = await supabase\n        .from('students')\n        .upsert(student, { onConflict: ['id'] });\n    if (error) console.error('Error saving student:', error);\n}\n\nasync function saveAbsence(absence) {\n    const { error } = await supabase\n        .from('absences')\n        .upsert(absence, { onConflict: ['id'] });\n    if (error) console.error('Error saving absence:', error);\n}\n\nasync function saveReport(report) {\n    const { error } = await supabase\n        .from('reports')\n        .upsert(report, { onConflict: ['id'] });\n    if (error) console.error('Error saving report:', error);\n}\n\n// --- Add new student example ---\nasync function addNewStudent(student) {\n    students.push(student);\n    await saveStudent(student);\n    updateDashboard();\n    updateStudentsTable();\n}\n\n// --- Initialize app ---\nasync function initApp() {\n    await loadData();\n}\n\ninitApp();\n\n// Login functionality\ndocument.getElementById('loginForm').addEventListener('submit', function(e) {\n    e.preventDefault();\n    \n    const username = document.getElementById('username').value;\n    const password = document.getElementById('password').value;\n    const errorDiv = document.getElementById('loginError');\n    \n    if (users[username] && users[username] === password) {\n        currentUser = username;\n        document.getElementById('currentUser').textContent = `Bienvenido, ${username}`;\n        document.getElementById('loginScreen').classList.add('hidden');\n        document.getElementById('mainApp').classList.remove('hidden');\n        loadData();\n        showSection('dashboard');\n        errorDiv.classList.add('hidden');\n    } else {\n        errorDiv.textContent = 'Usuario o contraseÃ±a incorrectos';\n        errorDiv.classList.remove('hidden');\n    }\n});\n\n// Logout functionality\ndocument.getElementById('logoutBtn').addEventListener('click', function() {\n    currentUser = '';\n    document.getElementById('username').value = '';\n    document.getElementById('password').value = '';\n    document.getElementById('loginScreen').classList.remove('hidden');\n    document.getElementById('mainApp').classList.add('hidden');\n    document.getElementById('loginError').classList.add('hidden');\n});\n\n// Navigation functionality\ndocument.querySelectorAll('.nav-link').forEach(link => {\n    link.addEventListener('click', function(e) {\n        e.preventDefault();\n        const section = this.getAttribute('data-section');\n        showSection(section);\n    });\n});\n\ndocument.getElementById('mobileNav').addEventListener('change', function() {\n    showSection(this.value);\n});\n\n// When selecting a student in the assign form, refresh available rooms\ndocument.getElementById('roomStudent')?.addEventListener('change', populateDropdowns);\n\nfunction showSection(sectionName) {\n    document.querySelectorAll('.content-section').forEach(section => {\n        section.classList.add('hidden');\n    });\n    document.getElementById(sectionName).classList.remove('hidden');\n    currentSection = sectionName;\n}\n\n// Add student functionality\ndocument.getElementById('addStudentForm').addEventListener('submit', function(e) {\n    e.preventDefault();\n\n    const student = {\n        id: Date.now(),\n        nombre: document.getElementById('studentNombre').value,\n        fechaNacimiento: document.getElementById('studentNacimiento').value,\n        mayor16: !!document.getElementById('studentMayor16').checked,\n        gender: document.getElementById('studentGenero').value,\n        curso: document.getElementById('studentCurso').value,\n        telefono1: document.getElementById('studentTelefono1').value,\n        telefono2: document.getElementById('studentTelefono2').value,\n        habitacion: null\n    };\n\n    // compute ageGroup: assumption >=18 is 'mayor'\n    const age = calculateAge(student.fechaNacimiento);\n    student.ageGroup = (age !== null && age >= 18) ? 'mayor' : 'menor';\n\n    students.push(student);\n    saveData();\n    updateDashboard();\n    updateStudentsTable();\n    populateDropdowns();\n    \n    // Reset form\n    this.reset();\n    \n    // Show success message\n    addActivity(`Nuevo alumno aÃ±adido: ${student.nombre}`);\n});\n\n// Update dashboard\nfunction updateDashboard() {\n    document.getElementById('totalAlumnos').textContent = students.length;\n    document.getElementById('habitacionesOcupadas').textContent = rooms.filter(room => room.occupied > 0).length;\n    document.getElementById('totalFaltas').textContent = absences.length;\n}\n\n// Update students table\nfunction updateStudentsTable() {\n    const tbody = document.getElementById('studentsTableBody');\n    \n    if (students.length === 0) {\n        tbody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-8 text-gray-500\">No hay alumnos registrados</td></tr>';\n        return;\n    }\n    \n    tbody.innerHTML = students.map(student => {\n        const age = calculateAge(student.fechaNacimiento);\n        const nacimientoDate = new Date(student.fechaNacimiento + 'T00:00:00');\n        const nacimientoStr = nacimientoDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\n        \n        return `\n        <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\n            <td class=\"py-3 px-4 font-medium\">${student.nombre}</td>\n            <td class=\"py-3 px-4 text-sm\">${nacimientoStr}</td>\n            <td class=\"py-3 px-4\"><span class=\"bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm font-medium\">${age} aÃ±os</span></td>\n            <td class=\"py-3 px-4\">${student.gender || '-'}</td>\n            <td class=\"py-3 px-4\">${student.curso}</td>\n            <td class=\"py-3 px-4 text-sm text-gray-600\">${student.telefono1 || '-'}${student.telefono2 ? '<br/>' + student.telefono2 : ''}</td>\n            <td class=\"py-3 px-4\">\n                ${student.habitacion ? `<span class=\"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs\">${student.habitacion}</span>` : '<span class=\"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs\">Sin asignar</span>'}\n            </td>\n            <td class=\"py-3 px-4\">\n                <button onclick=\"openStudentSeguimiento(${student.id})\" title=\"Seguimiento acadÃ©mico\" class=\"text-indigo-600 hover:text-indigo-800 mr-2\">\n                    <i class=\"fas fa-book\"></i>\n                </button>\n                <button onclick=\"editStudent(${student.id})\" class=\"text-blue-600 hover:text-blue-800 mr-2\">\n                    <i class=\"fas fa-edit\"></i>\n                </button>\n                <button onclick=\"deleteStudent(${student.id})\" class=\"text-red-600 hover:text-red-800\">\n                    <i class=\"fas fa-trash\"></i>\n                </button>\n            </td>\n        </tr>`;\n    }).join('');\n}\n\n// Update rooms grid\nfunction updateRoomsGrid() {\n    const grid = document.getElementById('roomsGrid');\n\n    // Group rooms by floor\n    const floors = {\n        1: { izquierda: [], derecha: [] },\n        2: { izquierda: [], derecha: [] }\n    };\n\n    rooms.forEach(room => {\n        const floor = room.floor || 1;\n        const side = room.side || 'izquierda';\n        if (!floors[floor]) floors[floor] = { izquierda: [], derecha: [] };\n        floors[floor][side].push(room);\n    });\n\n    const renderRoomCard = (room) => {\n        const occupiedCount = Object.values(room.beds).filter(bed => bed !== null).length;\n        const bedLetters = Object.keys(room.beds).sort();\n        \n        return `\n        <div class=\"bg-white p-6 rounded-xl shadow-sm border-2 ${occupiedCount === room.capacity ? 'border-red-300 bg-red-50' : occupiedCount > 0 ? 'border-yellow-300 bg-yellow-50' : 'border-green-300 bg-green-50'}\">\n            <div class=\"flex justify-between items-start mb-4\">\n                <div>\n                    <h3 class=\"text-lg font-semibold text-gray-800\">HabitaciÃ³n ${room.number}</h3>\n                    <p class=\"text-sm text-gray-600\">\n                        <span class=\"font-medium\">${room.gender === 'hombre' ? 'ðŸ‘¨ Hombres' : 'ðŸ‘© Mujeres'}</span> \n                        Â· Planta ${room.floor}\n                    </p>\n                </div>\n                <span class=\"px-3 py-1 rounded-full text-xs font-medium ${occupiedCount === 0 ? 'bg-green-100 text-green-800' : occupiedCount === room.capacity ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}\">${occupiedCount}/${room.capacity}</span>\n            </div>\n            <div class=\"grid grid-cols-3 gap-2 mb-4\">\n                ${bedLetters.map(bed => {\n                    const studentId = room.beds[bed];\n                    const student = studentId ? students.find(s => s.id === studentId) : null;\n                    return `\n                        <div class=\"flex flex-col items-center p-3 rounded-lg ${student ? 'bg-indigo-100 border-2 border-indigo-300' : 'bg-gray-100 border-2 border-gray-300'}\">\n                            <span class=\"text-xs font-bold text-gray-600 mb-1\">Cama ${bed}</span>\n                            ${student ? `\n                                <span class=\"text-xs text-center text-gray-700 font-medium\">${student.nombre.split(' ')[0]}</span>\n                            ` : `\n                                <span class=\"text-xs text-gray-500\">Vacante</span>\n                            `}\n                        </div>\n                    `;\n                }).join('')}\n            </div>\n            ${occupiedCount < room.capacity ? `<button onclick=\"assignRoomToStudent('${room.number}')\" class=\"w-full bg-indigo-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors\">Asignar</button>` : ''}\n        </div>\n    `;\n    };\n\n    // Build HTML by floors\n    let html = '';\n\n    [1, 2].forEach(floor => {\n        const floorData = floors[floor] || { izquierda: [], derecha: [] };\n        const floorLabel = floor === 1 ? 'PLANTA 1' : 'PLANTA 2';\n        \n        html += `\n            <div class=\"mb-8\">\n                <h3 class=\"text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-600 pb-2\">${floorLabel}</h3>\n                <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                    <!-- Izquierda (Hombres) -->\n                    <div>\n                        <h4 class=\"text-lg font-semibold text-gray-700 mb-4 text-center p-3 bg-blue-100 rounded-lg\">ðŸ‘¨ HOMBRES (Izquierda)</h4>\n                        <div class=\"space-y-4\">\n                            ${floorData.izquierda.length > 0 \n                                ? floorData.izquierda.map(room => renderRoomCard(room)).join('') \n                                : '<p class=\"text-gray-500 text-center py-6\">No hay habitaciones de hombres</p>'\n                            }\n                        </div>\n                    </div>\n                    \n                    <!-- Derecha (Mujeres) -->\n                    <div>\n                        <h4 class=\"text-lg font-semibold text-gray-700 mb-4 text-center p-3 bg-pink-100 rounded-lg\">ðŸ‘© MUJERES (Derecha)</h4>\n                        <div class=\"space-y-4\">\n                            ${floorData.derecha.length > 0 \n                                ? floorData.derecha.map(room => renderRoomCard(room)).join('') \n                                : '<p class=\"text-gray-500 text-center py-6\">No hay habitaciones de mujeres</p>'\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    grid.innerHTML = html;\n}\n\n// Update absences table\nfunction updateAbsencesTable() {\n    const tbody = document.getElementById('absencesTableBody');\n    const filterStudent = document.getElementById('filterStudent').value;\n    const filterDate = document.getElementById('filterDate').value;\n    \n    let filteredAbsences = absences;\n    \n    if (filterStudent) {\n        filteredAbsences = filteredAbsences.filter(absence => \n            absence.studentId == filterStudent\n        );\n    }\n    \n    if (filterDate) {\n        filteredAbsences = filteredAbsences.filter(absence => \n            absence.fecha === filterDate\n        );\n    }\n    \n    if (filteredAbsences.length === 0) {\n        tbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-8 text-gray-500\">No hay faltas registradas</td></tr>';\n        return;\n    }\n    \n    tbody.innerHTML = filteredAbsences.map(absence => {\n        const student = students.find(s => s.id === absence.studentId);\n        return `\n            <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\n                <td class=\"py-3 px-4 font-medium\">${student ? `${student.nombre}` : 'Alumno eliminado'}</td>\n                <td class=\"py-3 px-4\">${absence.fecha}</td>\n                <td class=\"py-3 px-4\">${absence.descripcion}</td>\n                <td class=\"py-3 px-4\">\n                    <button onclick=\"deleteAbsence(${absence.id})\" class=\"text-red-600 hover:text-red-800\">\n                        <i class=\"fas fa-trash\"></i>\n                    </button>\n                </td>\n            </tr>\n        `;\n    }).join('');\n}\n\n// Assign room functionality\ndocument.getElementById('assignRoomForm').addEventListener('submit', function(e) {\n    e.preventDefault();\n    \n    const studentId = parseInt(document.getElementById('roomStudent').value);\n    const roomNumber = document.getElementById('roomNumber').value;\n    const selectedBed = document.getElementById('roomBed') ? document.getElementById('roomBed').value : '';\n    \n    const student = students.find(s => s.id === studentId);\n    const room = rooms.find(r => r.number === roomNumber);\n    \n    if (!student || !room) return;\n    \n    // Compatibility checks: gender\n    const studentGender = student.gender;\n    if (room.gender && room.gender !== 'mixta' && studentGender !== 'otro' && room.gender !== studentGender) {\n        alert('La habitaciÃ³n seleccionada no es compatible con el gÃ©nero del alumno.');\n        return;\n    }\n    \n    // Determine bed to assign: chosen bed or first empty\n    let emptyBed = null;\n    if (selectedBed) {\n        if (room.beds[selectedBed] !== null) {\n            alert(`La cama ${selectedBed} ya estÃ¡ ocupada en esta habitaciÃ³n.`);\n            return;\n        }\n        emptyBed = selectedBed;\n    } else {\n        emptyBed = Object.keys(room.beds).find(bed => room.beds[bed] === null);\n    }\n    if (!emptyBed) {\n        alert('La habitaciÃ³n estÃ¡ llena. No hay camas disponibles.');\n        return;\n    }\n    \n    // Remove student from previous room\n    if (student.habitacion) {\n        const previousRoom = rooms.find(r => r.number === student.habitacion);\n        if (previousRoom && student.cama) {\n            previousRoom.beds[student.cama] = null;\n            previousRoom.occupied--;\n        }\n    }\n    \n    // Assign to new room and bed\n    student.habitacion = roomNumber;\n    student.cama = emptyBed;\n    room.beds[emptyBed] = studentId;\n    room.occupied++;\n    \n    saveData();\n    updateDashboard();\n    updateStudentsTable();\n    updateRoomsGrid();\n    populateDropdowns();\n    \n    // Reset form\n    this.reset();\n    \n    addActivity(`Asignada habitaciÃ³n ${roomNumber} cama ${emptyBed} a ${student.nombre}`);\n});\n\n// Add absence functionality\ndocument.getElementById('addAbsenceForm').addEventListener('submit', function(e) {\n    e.preventDefault();\n    \n    const absence = {\n        id: Date.now(),\n        studentId: parseInt(document.getElementById('absenceStudent').value),\n        fecha: document.getElementById('absenceDate').value,\n        descripcion: document.getElementById('absenceDescription').value\n    };\n    \n    absences.push(absence);\n    saveData();\n    updateDashboard();\n    updateAbsencesTable();\n    \n    // Update resumen if the student is selected\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\n    if (alumnoSelect && alumnoSelect.value === absence.studentId.toString()) {\n        updateAlumnoResumen(absence.studentId);\n    }\n    \n    // Reset form\n    this.reset();\n    \n    addActivity(`Falta registrada para ${students.find(s => s.id === absence.studentId)?.nombre}`);\n});\n\n// Add report ('parte') functionality\ndocument.getElementById('addReportForm')?.addEventListener('submit', function(e) {\n    if (!e) return; // guard\n    e.preventDefault();\n\n    const report = {\n        id: Date.now(),\n        studentId: parseInt(document.getElementById('reportStudent').value),\n        fecha: document.getElementById('reportDate').value,\n        tipo: document.getElementById('reportType').value,\n        descripcion: document.getElementById('reportDescription').value\n    };\n\n    reports.push(report);\n    saveData();\n    updateReportsTable();\n    \n    // Update resumen if the student is selected\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\n    if (alumnoSelect && alumnoSelect.value === report.studentId.toString()) {\n        updateAlumnoResumen(report.studentId);\n    }\n\n    // Reset form\n    this.reset();\n\n    addActivity(`Parte registrado para ${students.find(s => s.id === report.studentId)?.nombre}`);\n});\n\n// Populate dropdowns\nfunction populateDropdowns() {\n    const studentDropdowns = ['roomStudent', 'absenceStudent', 'filterStudent', 'seguimientoStudent'];\n    \n    studentDropdowns.forEach(id => {\n        const select = document.getElementById(id);\n        const currentValue = select.value;\n        \n        select.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \n            students.map(student => `\n                <option value=\"${student.id}\">${student.nombre}</option>\n            `).join('');\n        \n        select.value = currentValue;\n    });\n\n    // Report student select\n    const reportSelect = document.getElementById('reportStudent');\n    if (reportSelect) {\n        const currentValue = reportSelect.value;\n        reportSelect.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \n            students.map(student => `\n                <option value=\"${student.id}\">${student.nombre}</option>\n            `).join('');\n        reportSelect.value = currentValue;\n    }\n\n    // Seguimiento student select\n    const seguimientoSelect = document.getElementById('seguimientoStudent');\n    if (seguimientoSelect) {\n        const currentValue2 = seguimientoSelect.value;\n        seguimientoSelect.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \n            students.map(student => `\n                <option value=\"${student.id}\">${student.nombre}</option>\n            `).join('');\n        seguimientoSelect.value = currentValue2;\n        // attach change handler\n        seguimientoSelect.removeEventListener('change', updateSeguimientoTable);\n        seguimientoSelect.addEventListener('change', function() { updateSeguimientoTable(this.value); });\n    }\n\n    // Resumen alumno select\n    const alumnoResumenSelect = document.getElementById('alumnoResumenSelect');\n    if (alumnoResumenSelect) {\n        const currentValue3 = alumnoResumenSelect.value;\n        alumnoResumenSelect.innerHTML = '<option value=\"\">-- Seleccionar alumno --</option>' + \n            students.map(student => `\n                <option value=\"${student.id}\">${student.nombre}</option>\n            `).join('');\n        alumnoResumenSelect.value = currentValue3;\n        // attach change handler\n        alumnoResumenSelect.removeEventListener('change', updateAlumnoResumen);\n        alumnoResumenSelect.addEventListener('change', function() { updateAlumnoResumen(this.value); });\n    }\n    \n    const roomSelect = document.getElementById('roomNumber');\n    roomSelect.innerHTML = '<option value=\"\">Seleccionar habitaciÃ³n</option>' + \n        rooms.map(room => `\n            <option value=\"${room.number}\">${room.number} (${room.type}, ${room.occupied}/${room.capacity})</option>\n        `).join('');\n\n    // Update room options based on selected student gender when roomStudent changes\n    const roomStudentSelect = document.getElementById('roomStudent');\n    if (roomStudentSelect) {\n        roomStudentSelect.removeEventListener('change', updateRoomOptionsForSelectedStudent);\n        roomStudentSelect.addEventListener('change', updateRoomOptionsForSelectedStudent);\n        // Run once to reflect current selection\n        updateRoomOptionsForSelectedStudent();\n    }\n\n    // Attach listener to room select to update available bed options\n    const roomBedSelect = document.getElementById('roomBed');\n    if (roomSelect) {\n        roomSelect.removeEventListener('change', updateBedOptionsForSelectedRoom);\n        roomSelect.addEventListener('change', updateBedOptionsForSelectedRoom);\n        // initialize bed options based on current selection\n        updateBedOptionsForSelectedRoom();\n    }\n}\n\n// Populate bed options for the selected room\nfunction updateBedOptionsForSelectedRoom() {\n    const roomSelect = document.getElementById('roomNumber');\n    const bedSelect = document.getElementById('roomBed');\n    if (!roomSelect || !bedSelect) return;\n\n    const roomNumber = roomSelect.value;\n    bedSelect.innerHTML = '<option value=\"\">Seleccionar cama</option>';\n    if (!roomNumber) {\n        bedSelect.disabled = true;\n        return;\n    }\n\n    const room = rooms.find(r => r.number === roomNumber);\n    if (!room) {\n        bedSelect.disabled = true;\n        return;\n    }\n\n    const bedLetters = Object.keys(room.beds).sort();\n    let hasEmpty = false;\n    bedLetters.forEach(bed => {\n        const occupantId = room.beds[bed];\n        if (occupantId === null) {\n            hasEmpty = true;\n            bedSelect.innerHTML += `<option value=\"${bed}\">Cama ${bed} - Vacante</option>`;\n        } else {\n            const student = students.find(s => s.id === occupantId);\n            const name = student ? student.nombre.split(' ')[0] : 'Ocupada';\n            bedSelect.innerHTML += `<option value=\"${bed}\" disabled>Cama ${bed} - Ocupada (${name})</option>`;\n        }\n    });\n\n    bedSelect.disabled = !hasEmpty;\n}\n\n// Filter roomNumber options according to selected student's gender\nfunction updateRoomOptionsForSelectedStudent() {\n    const roomSelect = document.getElementById('roomNumber');\n    const roomStudentSelect = document.getElementById('roomStudent');\n    if (!roomSelect || !roomStudentSelect) return;\n\n    const studentId = parseInt(roomStudentSelect.value);\n    let allowedRooms = rooms;\n\n    if (studentId) {\n        const student = students.find(s => s.id === studentId);\n        if (student) {\n            const g = student.gender;\n            // Filter rooms by gender only\n            allowedRooms = rooms.filter(r => r.gender === g);\n        }\n    }\n\n    const currentValue = roomSelect.value;\n    roomSelect.innerHTML = '<option value=\"\">Seleccionar habitaciÃ³n</option>' + \n        allowedRooms.map(room => {\n            const floorLabel = room.floor === 1 ? 'Planta 1' : 'Planta 2';\n            const sideLabel = room.side === 'izquierda' ? 'Izquierda' : 'Derecha';\n            const genderLabel = room.gender === 'hombre' ? 'Hombres' : 'Mujeres';\n            return `\n                <option value=\"${room.number}\">${room.number} - ${floorLabel} (${genderLabel}, ${sideLabel}) - ${room.occupied}/${room.capacity}</option>\n            `;\n        }).join('');\n    roomSelect.value = currentValue;\n}\n\n// Update reports table\nfunction updateReportsTable() {\n    const tbody = document.getElementById('reportsTableBody');\n    if (!tbody) return;\n\n    if (reports.length === 0) {\n        tbody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-8 text-gray-500\">No hay partes registrados</td></tr>';\n        return;\n    }\n\n    tbody.innerHTML = reports.map(report => {\n        const student = students.find(s => s.id === report.studentId);\n        return `\n            <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\n                <td class=\"py-3 px-4 font-medium\">${student ? `${student.nombre}` : 'Alumno eliminado'}</td>\n                <td class=\"py-3 px-4\">${report.fecha}</td>\n                <td class=\"py-3 px-4\">${report.tipo}</td>\n                <td class=\"py-3 px-4\">${report.descripcion}</td>\n                <td class=\"py-3 px-4\">\n                    <button onclick=\"deleteReport(${report.id})\" class=\"text-red-600 hover:text-red-800\">\n                        <i class=\"fas fa-trash\"></i>\n                    </button>\n                </td>\n            </tr>\n        `;\n    }).join('');\n}\n\n// Seguimiento acadÃ©mico\ndocument.getElementById('addSeguimientoForm')?.addEventListener('submit', function(e) {\n    if (!e) return;\n    e.preventDefault();\n\n    const studentId = parseInt(document.getElementById('seguimientoStudent').value);\n    if (!studentId) {\n        alert('Seleccione un alumno para registrar el seguimiento');\n        return;\n    }\n\n    const asignatura = document.getElementById('seguimientoAsignatura').value;\n    const fecha = document.getElementById('seguimientoFecha').value;\n    const tipo = document.getElementById('seguimientoTipo').value;\n    const nota = document.getElementById('seguimientoNota').value;\n    const comentarios = document.getElementById('seguimientoComentarios').value;\n\n    const student = students.find(s => s.id === studentId);\n    if (!student) return;\n\n    if (!student.academic) student.academic = { records: [] };\n\n    const record = {\n        id: Date.now(),\n        fecha,\n        asignatura,\n        tipo,\n        nota,\n        comentarios\n    };\n\n    student.academic.records.push(record);\n    saveData();\n    updateSeguimientoTable(studentId);\n    \n    // Update resumen if same student is selected\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\n    if (alumnoSelect && alumnoSelect.value === studentId.toString()) {\n        updateAlumnoResumen(studentId);\n    }\n\n    this.reset();\n    addActivity(`Registro acadÃ©mico aÃ±adido para ${student.nombre}: ${asignatura}`);\n});\n\n// Update resumen del alumno\nfunction updateAlumnoResumen(studentId) {\n    const alumnoResumenCard = document.getElementById('alumnoResumenCard');\n    const alumnoResumenNombre = document.getElementById('alumnoResumenNombre');\n    const alumnoResumenFaltas = document.getElementById('alumnoResumenFaltas');\n    const alumnoResumenPartes = document.getElementById('alumnoResumenPartes');\n    const alumnoResumenSuspensas = document.getElementById('alumnoResumenSuspensas');\n    \n    if (!studentId) {\n        alumnoResumenCard.classList.add('hidden');\n        return;\n    }\n\n    const student = students.find(s => s.id === parseInt(studentId));\n    if (!student) {\n        alumnoResumenCard.classList.add('hidden');\n        return;\n    }\n\n    // Count faltas\n    const faltas = absences.filter(a => a.studentId === parseInt(studentId)).length;\n    \n    // Count partes\n    const partes = reports.filter(r => r.studentId === parseInt(studentId)).length;\n    \n    // Count suspensas\n    let suspensas = 0;\n    if (student.academic && student.academic.records) {\n        const isFail = (rec) => {\n            if (!rec) return false;\n            const notaRaw = (rec.nota || '').toString().trim().replace(',', '.');\n            const parsed = parseFloat(notaRaw);\n            if (!isNaN(parsed)) {\n                return parsed < 5;\n            }\n            const hay = (rec.tipo || '') + ' ' + (rec.comentarios || '') + ' ' + (rec.asignatura || '') + ' ' + (rec.nota || '');\n            const hayLc = hay.toLowerCase();\n            if (hayLc.includes('susp') || hayLc.includes('suspenso') || hayLc.includes('np') || hayLc.includes('no presentado')) return true;\n            return false;\n        };\n        suspensas = student.academic.records.filter(isFail).length;\n    }\n\n    // Update display\n    alumnoResumenNombre.textContent = student.nombre;\n    alumnoResumenFaltas.textContent = faltas;\n    alumnoResumenPartes.textContent = partes;\n    alumnoResumenSuspensas.textContent = suspensas;\n    \n    alumnoResumenCard.classList.remove('hidden');\n}\n\nfunction updateSeguimientoTable(studentId) {\n    const summaryDiv = document.getElementById('seguimientoSummary');\n    if (!summaryDiv) return;\n\n    if (!studentId) {\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-gray-500\">Seleccione un alumno para ver sus suspensas por trimestre</p></div>';\n        return;\n    }\n\n    const student = students.find(s => s.id === parseInt(studentId));\n    if (!student || !student.academic || student.academic.records.length === 0) {\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-gray-500\">No hay registros para este alumno</p></div>';\n        return;\n    }\n\n    // filter to only failing records (suspensas)\n    const isFail = (rec) => {\n        if (!rec) return false;\n        const notaRaw = (rec.nota || '').toString().trim().replace(',', '.');\n        const parsed = parseFloat(notaRaw);\n        if (!isNaN(parsed)) {\n            return parsed < 5; // numeric threshold: <5 is suspenso\n        }\n        // if nota not numeric, try keywords in tipo or comentarios or asignatura\n        const hay = (rec.tipo || '') + ' ' + (rec.comentarios || '') + ' ' + (rec.asignatura || '') + ' ' + (rec.nota || '');\n        const hayLc = hay.toLowerCase();\n        if (hayLc.includes('susp') || hayLc.includes('suspenso') || hayLc.includes('np') || hayLc.includes('no presentado')) return true;\n        return false;\n    };\n\n    const failing = student.academic.records.filter(isFail);\n    \n    if (failing.length === 0) {\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-green-600 text-lg font-semibold\"><i class=\"fas fa-check-circle mr-2\"></i>Ninguna asignatura suspensa</p></div>';\n        return;\n    }\n\n    // Group by trimester\n    const trimestres = {\n        'Trimestre 1': { count: 0, color: 'red' },\n        'Trimestre 2': { count: 0, color: 'orange' },\n        'Trimestre 3': { count: 0, color: 'red' }\n    };\n\n    failing.forEach(rec => {\n        const fecha = new Date(rec.fecha + 'T00:00:00');\n        const mes = fecha.getMonth() + 1;\n        \n        if (mes >= 9 && mes <= 11) {\n            trimestres['Trimestre 1'].count += 1;\n        } else if (mes >= 12 || mes <= 3) {\n            trimestres['Trimestre 2'].count += 1;\n        } else if (mes >= 4 && mes <= 8) {\n            trimestres['Trimestre 3'].count += 1;\n        }\n    });\n\n    let html = '';\n    Object.entries(trimestres).forEach(([trimestre, data]) => {\n        const bgColor = data.count === 0 ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300';\n        const textColor = data.count === 0 ? 'text-green-800' : 'text-red-800';\n        const iconColor = data.count === 0 ? 'text-green-600' : 'text-red-600';\n        \n        html += `\n            <div class=\"border-2 ${bgColor} rounded-lg p-6 text-center\">\n                <p class=\"text-sm font-medium text-gray-600 mb-2\">${trimestre}</p>\n                <div class=\"text-4xl font-bold ${textColor} mb-2\">\n                    <i class=\"fas ${data.count === 0 ? 'fa-check-circle' : 'fa-times-circle'} ${iconColor} mr-2\"></i>${data.count}\n                </div>\n                <p class=\"text-sm ${textColor} font-semibold\">${data.count === 1 ? 'asignatura suspensa' : 'asignaturas suspensas'}</p>\n            </div>\n        `;\n    });\n\n    summaryDiv.innerHTML = html;\n}\n\nfunction deleteAcademicRecord(studentId, recordId) {\n    if (!confirm('Â¿Eliminar este registro acadÃ©mico?')) return;\n    const student = students.find(s => s.id === studentId);\n    if (!student || !student.academic) return;\n    student.academic.records = student.academic.records.filter(r => r.id !== recordId);\n    saveData();\n    updateSeguimientoTable(studentId);\n    addActivity('Registro acadÃ©mico eliminado');\n}\n\n// helper to open seguimiento section and select a student\nfunction openStudentSeguimiento(studentId) {\n    showSection('seguimiento');\n    const sel = document.getElementById('seguimientoStudent');\n    if (sel) {\n        sel.value = studentId;\n        updateSeguimientoTable(studentId);\n    }\n}\n\n// Delete report\nfunction deleteReport(reportId) {\n    if (confirm('Â¿EstÃ¡ seguro de eliminar este parte?')) {\n        reports = reports.filter(r => r.id !== reportId);\n        saveData();\n        updateReportsTable();\n        addActivity('Parte eliminado');\n    }\n}\n\n// Filter functionality\ndocument.getElementById('filterStudent').addEventListener('change', updateAbsencesTable);\ndocument.getElementById('filterDate').addEventListener('change', updateAbsencesTable);\ndocument.getElementById('clearFilters').addEventListener('click', function() {\n    document.getElementById('filterStudent').value = '';\n    document.getElementById('filterDate').value = '';\n    updateAbsencesTable();\n});\n\n// Delete student\nfunction deleteStudent(studentId) {\n    if (confirm('Â¿EstÃ¡ seguro de eliminar este alumno?')) {\n        const student = students.find(s => s.id === studentId);\n\n        // Remove from room\n        if (student.habitacion) {\n            const room = rooms.find(r => r.number === student.habitacion);\n            if (room && student.cama) {\n                room.beds[student.cama] = null;\n                room.occupied--;\n            }\n        }\n\n        // Remove student\n        students = students.filter(s => s.id !== studentId);\n\n        // Remove related absences\n        absences = absences.filter(a => a.studentId !== studentId);\n\n        saveData();\n        updateDashboard();\n        updateStudentsTable();\n        updateRoomsGrid();\n        updateAbsencesTable();\n        populateDropdowns();\n\n        addActivity(`Alumno eliminado: ${student.nombre}`);\n    }\n}\n\n// Delete absence\nfunction deleteAbsence(absenceId) {\n    if (confirm('Â¿EstÃ¡ seguro de eliminar esta falta?')) {\n        absences = absences.filter(a => a.id !== absenceId);\n        saveData();\n        updateDashboard();\n        updateAbsencesTable();\n        \n        addActivity(`Falta eliminada`);\n    }\n}\n\n// Edit student (simplified version)\nfunction editStudent(studentId) {\n    const student = students.find(s => s.id === studentId);\n    if (!student) return;\n    \n    // In a real application, this would open a modal or navigate to an edit page\n    const newNombre = prompt('Nuevo nombre:', student.nombre);\n\n    if (newNombre) {\n        student.nombre = newNombre;\n        saveData();\n        updateStudentsTable();\n        populateDropdowns();\n\n        addActivity(`Alumno actualizado: ${newNombre}`);\n    }\n}\n\n// Assign room to student (alternative method)\nfunction assignRoomToStudent(roomNumber) {\n    const room = rooms.find(r => r.number === roomNumber);\n    const occupiedCount = Object.values(room.beds).filter(bed => bed !== null).length;\n    if (!room || occupiedCount >= room.capacity) return;\n    \n    const unassignedStudents = students.filter(s => !s.habitacion);\n    \n    if (unassignedStudents.length === 0) {\n        alert('No hay alumnos sin habitaciÃ³n asignada');\n        return;\n    }\n    \n    // Find first empty bed\n    const emptyBed = Object.keys(room.beds).find(bed => room.beds[bed] === null);\n    if (!emptyBed) {\n        alert('La habitaciÃ³n estÃ¡ llena');\n        return;\n    }\n    \n    const student = unassignedStudents[0];\n    student.habitacion = roomNumber;\n    student.cama = emptyBed;\n    room.beds[emptyBed] = student.id;\n    \n    saveData();\n    updateDashboard();\n    updateStudentsTable();\n    updateRoomsGrid();\n    populateDropdowns();\n    \n    addActivity(`Asignada habitaciÃ³n ${roomNumber} cama ${emptyBed} a ${student.nombre}`);\n}\n\n// Add activity log\nfunction addActivity(activity) {\n    const actividadDiv = document.getElementById('actividadReciente');\n    const now = new Date();\n    const timeString = now.toLocaleString('es-ES');\n    \n    const activityElement = document.createElement('div');\n    activityElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';\n    activityElement.innerHTML = `\n        <div class=\"flex items-center space-x-3\">\n            <i class=\"fas fa-clock text-gray-400\"></i>\n            <span class=\"text-sm text-gray-700\">${activity}</span>\n        </div>\n        <span class=\"text-xs text-gray-500\">${timeString}</span>\n    `;\n    \n    if (actividadDiv.children.length > 0 && actividadDiv.children[0].textContent.includes('No hay actividad reciente')) {\n        actividadDiv.innerHTML = '';\n    }\n    \n    actividadDiv.insertBefore(activityElement, actividadDiv.firstChild);\n    \n    // Keep only last 10 activities\n    while (actividadDiv.children.length > 10) {\n        actividadDiv.removeChild(actividadDiv.lastChild);\n    }\n}\n\n// --- Agenda de deberes (homeworks) ---\nfunction getWeekStartISO(date) {\n    const d = new Date(date);\n    // normalize to Monday as start of the week\n    const day = (d.getDay() + 6) % 7; // Monday=0..Sunday=6\n    d.setHours(0,0,0,0);\n    d.setDate(d.getDate() - day);\n    return d.toISOString().slice(0,10); // YYYY-MM-DD\n}\n\nfunction getWeekEndISOFromStart(weekStartISO) {\n    const d = new Date(weekStartISO + 'T00:00:00');\n    d.setDate(d.getDate() + 6);\n    return d.toISOString().slice(0,10);\n}\n\nfunction loadHomeworks() {\n    const saved = localStorage.getItem('homeworks');\n    if (saved) {\n        try { homeworks = JSON.parse(saved); } catch (e) { homeworks = {}; }\n    } else {\n        homeworks = {};\n    }\n}\n\nfunction saveHomeworks() {\n    localStorage.setItem('homeworks', JSON.stringify(homeworks));\n}\n\nlet currentAgendaWeekKey = null;\n\n// Navigation between weeks for homework agenda\nfunction previousWeek() {\n    if (!currentAgendaWeekKey) {\n        currentAgendaWeekKey = getWeekStartISO(new Date());\n    }\n    const d = new Date(currentAgendaWeekKey + 'T00:00:00');\n    d.setDate(d.getDate() - 7);\n    currentAgendaWeekKey = d.toISOString().slice(0, 10);\n    renderAgenda();\n}\n\nfunction nextWeek() {\n    if (!currentAgendaWeekKey) {\n        currentAgendaWeekKey = getWeekStartISO(new Date());\n    }\n    const d = new Date(currentAgendaWeekKey + 'T00:00:00');\n    d.setDate(d.getDate() + 7);\n    currentAgendaWeekKey = d.toISOString().slice(0, 10);\n    renderAgenda();\n}\n\nfunction goToCurrentWeek() {\n    currentAgendaWeekKey = getWeekStartISO(new Date());\n    renderAgenda();\n}\n\n// Review panel functions\nfunction openReviewPanel() {\n    const reviewPanel = document.getElementById('reviewPanel');\n    const reviewContent = document.getElementById('reviewContent');\n    \n    if (!reviewPanel) return;\n    \n    // Get all weeks with homeworks\n    const weeks = Object.keys(homeworks).sort().reverse(); // Most recent first\n    \n    if (weeks.length === 0) {\n        reviewContent.innerHTML = `\n            <div class=\"text-center py-8\">\n                <p class=\"text-gray-500 text-lg\">No hay deberes registrados aÃºn.</p>\n            </div>\n        `;\n        reviewPanel.classList.remove('hidden');\n        return;\n    }\n    \n    let html = `\n        <div class=\"space-y-4\">\n            <p class=\"text-sm text-gray-600 mb-4\">Se encontraron <strong>${weeks.length}</strong> semana(s) con deberes registrados.</p>\n    `;\n    \n    weeks.forEach(weekStart => {\n        const weekEnd = getWeekEndISOFromStart(weekStart);\n        const startDate = new Date(weekStart + 'T00:00:00');\n        const endDate = new Date(weekEnd + 'T00:00:00');\n        \n        const startStr = startDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\n        const endStr = endDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\n        \n        const weekData = homeworks[weekStart] || {};\n        const hasContent = Object.values(weekData).some(v => v && v.trim().length > 0);\n        \n        // Count how many estudios have content\n        const filledStudios = Object.entries(weekData)\n            .filter(([, v]) => v && v.trim().length > 0)\n            .length;\n        \n        html += `\n            <div class=\"border border-gray-300 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer\" onclick=\"showWeekReview('${weekStart}')\">\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <h4 class=\"font-semibold text-gray-800\">Semana: ${startStr} â†’ ${endStr}</h4>\n                        <p class=\"text-sm text-gray-600 mt-1\">\n                            <i class=\"fas fa-book mr-1\"></i>\n                            ${filledStudios > 0 ? `${filledStudios} estudio(s) con deberes` : 'Sin deberes registrados'}\n                        </p>\n                    </div>\n                    <div class=\"text-right\">\n                        <button onclick=\"loadWeekFromReview('${weekStart}', event)\" class=\"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors\">\n                            <i class=\"fas fa-pencil-alt mr-1\"></i>Editar\n                        </button>\n                    </div>\n                </div>\n                <div id=\"weekPreview_${weekStart}\" class=\"mt-3 text-sm text-gray-700 hidden\">\n                    <!-- Preview will be generated on click -->\n                </div>\n            </div>\n        `;\n    });\n    \n    html += `</div>`;\n    \n    reviewContent.innerHTML = html;\n    reviewPanel.classList.remove('hidden');\n}\n\nfunction closeReviewPanel() {\n    const reviewPanel = document.getElementById('reviewPanel');\n    if (reviewPanel) {\n        reviewPanel.classList.add('hidden');\n    }\n}\n\nfunction showWeekReview(weekStart) {\n    const previewDiv = document.getElementById(`weekPreview_${weekStart}`);\n    if (!previewDiv) return;\n    \n    if (previewDiv.classList.contains('hidden')) {\n        // Show preview\n        const weekData = homeworks[weekStart] || {};\n        let html = '<div class=\"space-y-2 mt-2 pt-3 border-t border-gray-200\">';\n        \n        for (let i = 1; i <= 4; i++) {\n            const estudioId = `estudio${i}`;\n            const value = weekData[estudioId] || '';\n            if (value.trim().length > 0) {\n                html += `\n                    <div class=\"pl-3 border-l-2 border-indigo-400\">\n                        <p class=\"font-medium text-gray-700\">Estudio ${i}:</p>\n                        <p class=\"text-gray-600 whitespace-pre-wrap text-sm\">${value.substring(0, 150)}${value.length > 150 ? '...' : ''}</p>\n                    </div>\n                `;\n            }\n        }\n        \n        html += '</div>';\n        previewDiv.innerHTML = html;\n        previewDiv.classList.remove('hidden');\n    } else {\n        previewDiv.classList.add('hidden');\n    }\n}\n\nfunction loadWeekFromReview(weekStart, event) {\n    event.stopPropagation();\n    currentAgendaWeekKey = weekStart;\n    closeReviewPanel();\n    renderAgenda();\n    // Scroll to top to see the agenda\n    document.getElementById('agenda').scrollIntoView({ behavior: 'smooth' });\n}\n\nfunction renderAgenda() {\n    const grid = document.getElementById('agendaGrid');\n    const weekSelector = document.getElementById('weekSelector');\n    if (!grid) return;\n\n    // If no week selected, show current week\n    if (!currentAgendaWeekKey) {\n        currentAgendaWeekKey = getWeekStartISO(new Date());\n    }\n\n    const weekStart = currentAgendaWeekKey;\n    const weekEnd = getWeekEndISOFromStart(weekStart);\n\n    const weekData = homeworks[weekStart] || {};\n\n    // Format dates for display\n    const startDate = new Date(weekStart + 'T00:00:00');\n    const endDate = new Date(weekEnd + 'T00:00:00');\n    \n    const startStr = startDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\n    const endStr = endDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\n    \n    // Update week selector display\n    weekSelector.textContent = `${startStr} â†’ ${endStr}`;\n\n    // Check if this is the current week\n    const today = new Date();\n    const currentWeekStart = getWeekStartISO(today);\n    const isCurrentWeek = weekStart === currentWeekStart;\n\n    // show week range\n    let html = `<div class=\"mb-4\">\n        <h3 class=\"text-lg font-medium\">Semana: ${weekStart} â†’ ${weekEnd}</h3>\n        ${isCurrentWeek ? '<p class=\"text-sm text-green-600 font-medium\"><i class=\"fas fa-check-circle mr-1\"></i>Esta es la semana actual</p>' : '<p class=\"text-sm text-gray-500\">Semana anterior/futura</p>'}\n    </div>`;\n    \n    html += `<div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">`;\n    html += '<!-- Estudios -->';\n    \n    for (let i = 1; i <= 4; i++) {\n        const estudioId = `estudio${i}`;\n        const value = (weekData && weekData[estudioId]) ? weekData[estudioId] : '';\n        const hasContent = value.trim().length > 0;\n        \n        html += `\n            <div class=\"bg-white p-4 rounded-lg border ${hasContent ? 'border-indigo-300 bg-indigo-50' : 'border-gray-200'}\">\n                <h4 class=\"text-md font-semibold mb-2 text-gray-800\">Estudio ${i}</h4>\n                <textarea id=\"homework_${estudioId}\" rows=\"6\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500\" placeholder=\"Escribe los deberes para esta semana\">${value}</textarea>\n                <div class=\"mt-3 flex items-center justify-between gap-2\">\n                    <button onclick=\"saveHomework('${estudioId}')\" class=\"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors\">\n                        <i class=\"fas fa-save mr-1\"></i>Guardar\n                    </button>\n                    <button onclick=\"clearHomework('${estudioId}')\" class=\"text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 px-2 py-1 rounded transition-colors\">\n                        <i class=\"fas fa-trash-alt mr-1\"></i>Limpiar\n                    </button>\n                </div>\n            </div>\n        `;\n    }\n    html += '</div>';\n\n    grid.innerHTML = html;\n}\n\nfunction saveHomework(estudioId) {\n    if (!currentAgendaWeekKey) currentAgendaWeekKey = getWeekStartISO(new Date());\n    if (!homeworks[currentAgendaWeekKey]) homeworks[currentAgendaWeekKey] = {};\n    const ta = document.getElementById(`homework_${estudioId}`);\n    if (!ta) return;\n    homeworks[currentAgendaWeekKey][estudioId] = ta.value;\n    saveHomeworks();\n    addActivity(`Deberes guardados para ${estudioId} (${currentAgendaWeekKey})`);\n    // small feedback\n    ta.classList.add('ring-2','ring-green-300');\n    setTimeout(() => ta.classList.remove('ring-2','ring-green-300'), 900);\n}\n\nfunction clearHomework(estudioId) {\n    const ta = document.getElementById(`homework_${estudioId}`);\n    if (!ta) return;\n    if (!confirm('Â¿Limpiar los deberes de esta semana para este estudio?')) return;\n    ta.value = '';\n    if (homeworks[currentAgendaWeekKey]) delete homeworks[currentAgendaWeekKey][estudioId];\n    saveHomeworks();\n    addActivity(`Deberes limpiados para ${estudioId} (${currentAgendaWeekKey})`);\n}\n\n\n// Set today's date as default\nonDOMReady(() => {\n    const absenceDate = document.getElementById('absenceDate');\n    if (absenceDate) absenceDate.valueAsDate = new Date();\n    const reportDate = document.getElementById('reportDate');\n    if (reportDate) reportDate.valueAsDate = new Date();\n});\n\n// Initialize the application\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Load data on page load\n    loadData();\n\n    // Login functionality\n    const loginForm = document.getElementById('loginForm');\n    if (loginForm) {\n        loginForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const username = document.getElementById('username').value;\n            const password = document.getElementById('password').value;\n            const errorDiv = document.getElementById('loginError');\n\n            if (users[username] && users[username] === password) {\n                currentUser = username;\n                document.getElementById('currentUser').textContent = `Bienvenido, ${username}`;\n                document.getElementById('loginScreen').classList.add('hidden');\n                document.getElementById('mainApp').classList.remove('hidden');\n                loadData();\n                showSection('dashboard');\n                errorDiv.classList.add('hidden');\n            } else {\n                errorDiv.textContent = 'Usuario o contraseÃ±a incorrectos';\n                errorDiv.classList.remove('hidden');\n            }\n        });\n    }\n\n    // Logout functionality\n    const logoutBtn = document.getElementById('logoutBtn');\n    if (logoutBtn) {\n        logoutBtn.addEventListener('click', function() {\n            currentUser = '';\n            document.getElementById('username').value = '';\n            document.getElementById('password').value = '';\n            document.getElementById('loginScreen').classList.remove('hidden');\n            document.getElementById('mainApp').classList.add('hidden');\n            document.getElementById('loginError').classList.add('hidden');\n        });\n    }\n\n    // Navigation functionality\n    document.querySelectorAll('.nav-link').forEach(link => {\n        link.addEventListener('click', function(e) {\n            e.preventDefault();\n            const section = this.getAttribute('data-section');\n            showSection(section);\n        });\n    });\n\n    const mobileNav = document.getElementById('mobileNav');\n    if (mobileNav) {\n        mobileNav.addEventListener('change', function() {\n            showSection(this.value);\n        });\n    }\n\n    // When selecting a student in the assign form, refresh available rooms\n    const roomStudent = document.getElementById('roomStudent');\n    if (roomStudent) {\n        roomStudent.addEventListener('change', populateDropdowns);\n    }\n\n    // Add student functionality\n    const addStudentForm = document.getElementById('addStudentForm');\n    if (addStudentForm) {\n        addStudentForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const student = {\n                id: Date.now(),\n                nombre: document.getElementById('studentNombre').value,\n                fechaNacimiento: document.getElementById('studentNacimiento').value,\n                mayor16: !!document.getElementById('studentMayor16').checked,\n                gender: document.getElementById('studentGenero').value,\n                curso: document.getElementById('studentCurso').value,\n                telefono1: document.getElementById('studentTelefono1').value,\n                telefono2: document.getElementById('studentTelefono2').value,\n                habitacion: null\n            };\n            const age = calculateAge(student.fechaNacimiento);\n            student.ageGroup = (age !== null && age >= 18) ? 'mayor' : 'menor';\n            students.push(student);\n            saveData();\n            updateDashboard();\n            updateStudentsTable();\n            populateDropdowns();\n            this.reset();\n            addActivity(`Nuevo alumno aÃ±adido: ${student.nombre}`);\n        });\n    }\n\n    // Assign room functionality\n    const assignRoomForm = document.getElementById('assignRoomForm');\n    if (assignRoomForm) {\n        assignRoomForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const studentId = parseInt(document.getElementById('roomStudent').value);\n            const roomNumber = document.getElementById('roomNumber').value;\n            const selectedBed = document.getElementById('roomBed') ? document.getElementById('roomBed').value : '';\n            const student = students.find(s => s.id === studentId);\n            const room = rooms.find(r => r.number === roomNumber);\n            if (!student || !room) return;\n            const studentGender = student.gender;\n            if (room.gender && room.gender !== 'mixta' && studentGender !== 'otro' && room.gender !== studentGender) {\n                alert('La habitaciÃ³n seleccionada no es compatible con el gÃ©nero del alumno.');\n                return;\n            }\n            let emptyBed = null;\n            if (selectedBed) {\n                if (room.beds[selectedBed] !== null) {\n                    alert(`La cama ${selectedBed} ya estÃ¡ ocupada en esta habitaciÃ³n.`);\n                    return;\n                }\n                emptyBed = selectedBed;\n            } else {\n                emptyBed = Object.keys(room.beds).find(bed => room.beds[bed] === null);\n            }\n            if (!emptyBed) {\n                alert('La habitaciÃ³n estÃ¡ llena. No hay camas disponibles.');\n                return;\n            }\n            if (student.habitacion) {\n                const previousRoom = rooms.find(r => r.number === student.habitacion);\n                if (previousRoom && student.cama) {\n                    previousRoom.beds[student.cama] = null;\n                    previousRoom.occupied--;\n                }\n            }\n            student.habitacion = roomNumber;\n            student.cama = emptyBed;\n            room.beds[emptyBed] = studentId;\n            room.occupied++;\n            saveData();\n            updateDashboard();\n            updateStudentsTable();\n            updateRoomsGrid();\n            populateDropdowns();\n            this.reset();\n            addActivity(`Asignada habitaciÃ³n ${roomNumber} cama ${emptyBed} a ${student.nombre}`);\n        });\n    }\n\n    // Add absence functionality\n    const addAbsenceForm = document.getElementById('addAbsenceForm');\n    if (addAbsenceForm) {\n        addAbsenceForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const absence = {\n                id: Date.now(),\n                studentId: parseInt(document.getElementById('absenceStudent').value),\n                fecha: document.getElementById('absenceDate').value,\n                descripcion: document.getElementById('absenceDescription').value\n            };\n            absences.push(absence);\n            saveData();\n            updateDashboard();\n            updateAbsencesTable();\n            this.reset();\n            addActivity(`Nueva falta registrada para el alumno ${students.find(s => s.id === absence.studentId)?.nombre}`);\n        });\n    }\n\n    // Add report functionality\n    const addReportForm = document.getElementById('addReportForm');\n    if (addReportForm) {\n        addReportForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const report = {\n                id: Date.now(),\n                studentId: parseInt(document.getElementById('reportStudent').value),\n                fecha: document.getElementById('reportDate').value,\n                descripcion: document.getElementById('reportDescription').value\n            };\n            reports.push(report);\n            saveData();\n            updateDashboard();\n            updateReportsTable();\n            this.reset();\n            addActivity(`Nuevo informe registrado para el alumno ${students.find(s => s.id === report.studentId)?.nombre}`);\n        });\n    }\n\n    // Add seguimiento functionality\n    const addSeguimientoForm = document.getElementById('addSeguimientoForm');\n    if (addSeguimientoForm) {\n        addSeguimientoForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            const seguimiento = {\n                id: Date.now(),\n                studentId: parseInt(document.getElementById('seguimientoStudent').value),\n                fecha: document.getElementById('seguimientoDate').value,\n                descripcion: document.getElementById('seguimientoDescription').value\n            };\n            if (!seguimientos[seguimiento.studentId]) {\n                seguimientos[seguimiento.studentId] = [];\n            }\n            seguimientos[seguimiento.studentId].push(seguimiento);\n            saveData();\n            updateSeguimientoTable(seguimiento.studentId);\n            this.reset();\n            addActivity(`Nuevo seguimiento registrado para el alumno ${students.find(s => s.id === seguimiento.studentId)?.nombre}`);\n        });\n    }\n\n    // Filter absences\n    const filterStudent = document.getElementById('filterStudent');\n    if (filterStudent) {\n        filterStudent.addEventListener('change', updateAbsencesTable);\n    }\n    const filterDate = document.getElementById('filterDate');\n    if (filterDate) {\n        filterDate.addEventListener('change', updateAbsencesTable);\n    }\n    const clearFilters = document.getElementById('clearFilters');\n    if (clearFilters) {\n        clearFilters.addEventListener('click', function() {\n            document.getElementById('filterStudent').value = '';\n            document.getElementById('filterDate').value = '';\n            updateAbsencesTable();\n        });\n    }\n});"],"names":["supabaseUrl","supabaseKey","supabase","createClient","onDOMReady","callback","students","absences","reports","homeworks","users","initializeRooms","bedLetters","createRooms","startNum","endNum","gender","floor","side","i","number","beds","letter","calculateAge","dateString","today","birth","age","m","checkBirthdays","currentMonth","currentDay","birthdayStudents","student","birthDate","birthMonth","birthDay","showBirthdayModal","modal","message","names","s","createConfetti","closeBirthdayModal","container","confettiPieces","colors","piece","loadData","studentsData","studentsError","absencesData","absencesError","reportsData","reportsError","updateDashboard","updateStudentsTable","updateRoomsGrid","updateAbsencesTable","updateReportsTable","populateDropdowns","loadHomeworks","renderAgenda","initApp","e","username","password","errorDiv","showSection","link","section","sectionName","addActivity","room","tbody","nacimientoStr","grid","floors","renderRoomCard","occupiedCount","bed","studentId","html","floorData","filterStudent","filterDate","filteredAbsences","absence","roomNumber","selectedBed","r","studentGender","emptyBed","previousRoom","alumnoSelect","updateAlumnoResumen","report","id","select","currentValue","reportSelect","seguimientoSelect","currentValue2","updateSeguimientoTable","alumnoResumenSelect","currentValue3","roomSelect","roomStudentSelect","updateRoomOptionsForSelectedStudent","updateBedOptionsForSelectedRoom","bedSelect","hasEmpty","occupantId","name","allowedRooms","g","floorLabel","sideLabel","genderLabel","asignatura","fecha","tipo","nota","comentarios","record","alumnoResumenCard","alumnoResumenNombre","alumnoResumenFaltas","alumnoResumenPartes","alumnoResumenSuspensas","faltas","a","partes","suspensas","isFail","rec","notaRaw","parsed","hayLc","summaryDiv","failing","trimestres","mes","trimestre","data","bgColor","textColor","iconColor","activity","actividadDiv","timeString","activityElement","getWeekStartISO","date","d","day","getWeekEndISOFromStart","weekStartISO","saved","currentAgendaWeekKey","weekSelector","weekStart","weekEnd","weekData","startDate","endDate","startStr","endStr","currentWeekStart","estudioId","value","hasContent","absenceDate","reportDate","loginForm","logoutBtn","mobileNav","roomStudent","addStudentForm","assignRoomForm","addAbsenceForm","addReportForm","addSeguimientoForm","seguimiento","clearFilters"],"mappings":"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"}